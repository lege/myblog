<!DOCTYPE HTML>
<html>
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=10,IE=9,IE=8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimum-scale=1.0, maximum-scale=1.0">
<title>MySQL HA on debian8 | 失眠猪的博客</title>
<script>
window._deel = {name: '失眠猪的博客',url: 'http://112.74.18.181/wp-content/themes/yusi1.0', ajaxpager: '', commenton: 1, roll: [0,0]}
</script>

<!-- All in One SEO Pack 2.2.6.2 by Michael Torbert of Semper Fi Web Design[247,288] -->
<meta name="description" itemprop="description" content="MYSQL HA on debian8 调研 系统部署 root@node1:/# fdisk -l Disk /dev/sda: 68.4 GiB, 73407488000 bytes, 143374000 sectors Units: sectors of 1 * 512 = 512" />

<link rel="canonical" href="http://112.74.18.181/?p=120" />
<!-- /all in one seo pack -->
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"http:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/112.74.18.181\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.2.5"}};
			!function(a,b,c){function d(a){var c=b.createElement("canvas"),d=c.getContext&&c.getContext("2d");return d&&d.fillText?(d.textBaseline="top",d.font="600 32px Arial","flag"===a?(d.fillText(String.fromCharCode(55356,56812,55356,56807),0,0),c.toDataURL().length>3e3):(d.fillText(String.fromCharCode(55357,56835),0,0),0!==d.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel='stylesheet' id='page-list-style-css'  href='http://112.74.18.181/wp-content/plugins/sitemap/css/page-list.css?ver=4.3' type='text/css' media='all' />
<link rel='stylesheet' id='style-css'  href='http://112.74.18.181/wp-content/themes/yusi1.0/style.css?ver=1.0' type='text/css' media='all' />
<link rel='stylesheet' id='wp-markdown-prettify-css'  href='http://112.74.18.181/wp-content/plugins/markdown/css/prettify.css?ver=1.5.1' type='text/css' media='all' />
<script type='text/javascript' src='http://112.74.18.181/wp-includes/js/jquery/jquery.js?ver=1.11.2'></script>
<script type='text/javascript' src='http://112.74.18.181/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.2.1'></script>
<script type='text/javascript' src='http://112.74.18.181/wp-content/themes/yusi1.0/js/jquery.js?ver=1.0'></script>
<script type='text/javascript' src='http://112.74.18.181/wp-content/plugins/markdown/js/prettify.min.js?ver=1.5.1'></script>
<link rel='prev' title='apt出现no public key available for the following key IDs' href='http://112.74.18.181/?p=90' />
<link rel='shortlink' href='http://112.74.18.181/?p=120' />
<!-- <meta name="NextGEN" version="2.0.79" /> -->
<link href='http://112.74.18.181/wp-content/plugins/search-by-category/sbc-style.css' type='text/css' rel='stylesheet' /><meta name="keywords" content="SA">
<meta name="description" content="MYSQL HA on debian8 调研  [toc]  系统部署  root@node1:/# fdisk -l  Disk /dev/sda: 68.4 GiB, 73407488000 bytes, 143374000 sectors Units: sectors of 1 * 512 = 512 bytes Sector size (logical/physical): 512 bytes / 512 bytes I/O s">
<!--[if lt IE 9]><script src="http://112.74.18.181/wp-content/themes/yusi1.0/js/html5.js"></script><![endif]-->
</head>
<body class="single single-post postid-120 single-format-standard">

<header id="header" class="header">
<div class="container-inner">
 <div class="yusi-logo">
                    <a href="/">
                        <h1>
                                                        <span class="yusi-mono">失眠猪的博客</span>
                                                        <span class="yusi-bloger">lege is here</span>
                                                    </h1>
                    </a>
    </div>
</div>

	<div id="nav-header" class="navbar">
		
		<ul class="nav">
			<li id="menu-item-52" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-52"><a href="http://112.74.18.181/">首页</a></li>
<li id="menu-item-105" class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor current-menu-parent current-post-parent menu-item-105"><a href="http://112.74.18.181/?cat=17">SA</a></li>
<li id="menu-item-54" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children menu-item-54"><a href="http://112.74.18.181/?cat=7">技术分享</a>
<ul class="sub-menu">
	<li id="menu-item-55" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-55"><a href="http://112.74.18.181/?cat=10">network</a></li>
	<li id="menu-item-59" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-59"><a href="http://112.74.18.181/?cat=8">system</a></li>
	<li id="menu-item-57" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-57"><a href="http://112.74.18.181/?cat=11">python</a></li>
	<li id="menu-item-58" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-58"><a href="http://112.74.18.181/?cat=12">shell</a></li>
	<li id="menu-item-56" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-56"><a href="http://112.74.18.181/?cat=13">other</a></li>
</ul>
</li>
<li id="menu-item-74" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-74"><a href="http://112.74.18.181/?cat=16">Net Security</a></li>
<li id="menu-item-60" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children menu-item-60"><a href="http://112.74.18.181/?cat=1">生活随笔</a>
<ul class="sub-menu">
	<li id="menu-item-61" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-61"><a href="http://112.74.18.181/?cat=6">个人随笔</a></li>
	<li id="menu-item-62" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-62"><a href="http://112.74.18.181/?cat=5">生活日记</a></li>
</ul>
</li>
<li id="menu-item-53" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-53"><a href="http://112.74.18.181/?page_id=50">Advice for Me</a></li>
<li id="menu-item-73" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-73"><a href="http://112.74.18.181/?page_id=71">About Me</a></li>
<li style="float:right;">
                    <div class="toggle-search"><i class="fa fa-search"></i></div>
<div class="search-expand" style="display: none;"><div class="search-expand-inner"><form method="get" class="searchform themeform" onsubmit="location.href='/?s=' + encodeURIComponent(this.s.value).replace(/%20/g, '+'); return false;" action="/"><div> <input type="ext" class="search" name="s" onblur="if(this.value=='')this.value='search...';" onfocus="if(this.value=='search...')this.value='';" value="search..."></div></form></div></div>
</li>
		</ul>
	</div>
	</div>
</header>
<section class="container"><div class="speedbar">
				<div class="toptip"><strong class="text-success"><i class="fa fa-volume-up"></i> </strong> 本blog刚刚创建，有啥好的文章及建议意见的欢迎给我留言。。。
lege is here</div>
	</div>
	<div class="content-wrap">
	<div class="content">

				<header class="article-header">
			<h1 class="article-title"><a href="http://112.74.18.181/?p=120">MySQL HA on debian8</a></h1>
			<div class="meta">
				<span id="mute-category" class="muted"><i class="fa fa-list-alt"></i><a href="http://112.74.18.181/?cat=17"> SA</a></span>				<span class="muted"><i class="fa fa-user"></i> <a href="http://112.74.18.181/?author=1">lege</a></span>
				<time class="muted"><i class="fa fa-clock-o"></i> 17小时前</time>
				<span class="muted"><i class="fa fa-eye"></i> 11℃</span>
				<span class="muted"><i class="fa fa-comments-o"></i> <a href="http://112.74.18.181/?p=120#comments">0评论</a></span>							</div>
		</header>
		<article class="article-content">
			<h2>MYSQL HA on debian8 调研</h2>
<p>[toc]</p>
<h2>系统部署</h2>
<pre><code>root@node1:/# fdisk -l

Disk /dev/sda: 68.4 GiB, 73407488000 bytes, 143374000 sectors
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disklabel type: dos
Disk identifier: 0xf46974b2

Device     Boot    Start       End   Sectors  Size Id Type
/dev/sda1  *        2048   4196351   4194304    2G 83 Linux
/dev/sda2        4196352   8390655   4194304    2G 82 Linux swap / Solaris
/dev/sda3        8390656 143373999 134983344 64.4G  f W95 Ext'd (LBA)
/dev/sda5        8390664  16779271   8388608    4G 83 Linux
/dev/sda6       16779280  33556495  16777216    8G 83 Linux
/dev/sda7       33556504  35653655   2097152    1G 83 Linux
/dev/sda8       35653664 143373999 107720336 51.4G 83 Linux

root@node1:/# df -h
Filesystem      Size  Used Avail Use% Mounted on
/dev/sda1       2.0G  264M  1.6G  15% /
udev             10M     0   10M   0% /dev
tmpfs           2.4G  8.7M  2.4G   1% /run
/dev/sda5       3.9G  375M  3.3G  11% /usr
tmpfs           5.9G     0  5.9G   0% /dev/shm
tmpfs           5.0M     0  5.0M   0% /run/lock
tmpfs           5.9G     0  5.9G   0% /sys/fs/cgroup
/dev/sda6       7.8G  185M  7.2G   3% /var
/dev/sda8        51G   52M   50G   1% /home
/dev/sda7       976M  1.3M  959M   1% /tmp
</code></pre>
<p>让机房重装系统忘记跟机房说多分一个分区出来，机房把剩下的所有分区都给了 /home 没办法自己手动卸载重新分吧</p>
<pre><code>root@node1:/# lsof /home/
COMMAND  PID    USER   FD   TYPE DEVICE SIZE/OFF    NODE NAME
bash    6245 gzzoule  cwd    DIR    8,8     4096 1048577 /home/gzzoule
su      6251    root  cwd    DIR    8,8     4096 1048577 /home/gzzoule  
</code></pre>
<p>在那个自己的bash下是没法操作的，所以登上机器先 cd 到根目录，然后 su 到 root</p>
<pre><code>gzzoule@node1:~$ cd /
gzzoule@node1:/$ su
Password:
root@node1:/# lsof /home/
root@node1:/#
</code></pre>
<p>记得 umount 掉 home 之前先把 /home 里面所有东西都备份到其他分区里，这样分区完，再拷贝过来保证下次自己可以重连服务器。</p>
<pre><code>root@node1:/home# cd /var/
root@node1:/var# ls
backups  cache  lib  local  lock  log  lost+found  mail  opt  run  spool  tmp
root@node1:/var# mkdir home
root@node1:/var# cd home/
root@node1:/var/home# ls
root@node1:/var/home# rsync -av /home/ ./
root@node1:/# umount /home/
</code></pre>
<p>分区</p>
<pre><code>root@node1:/home# cfdisk /dev/sda

root@node1:/# mkfs.ext4 /dev/sda8
root@node1:/# apt-get install parted
root@node1:/# partprobe
root@node1:/# mount /dev/sda8 /home
root@node1:/# rsync -av /var/home /home/
root@node1:/# vim /etc/fstab
</code></pre>
<ul>
<li>node2 也执行同样操作</li>
</ul>
<h2>DRBD 安装配置</h2>
<h3>安装 drbd：</h3>
<pre><code>root@node1:/# aptitude search drbd
p   drbd-doc                                                              - RAID 1 over TCP/IP for Linux (user documentation)
i A drbd-utils                                                            - RAID 1 over TCP/IP for Linux (user utilities)
p   drbd-utils-dbg                                                        - RAID 1 over TCP/IP for Linux (user utilities' debug symbols)
i   drbd8-utils                                                           - transitional dummy package
i   drbdlinks                                                             - Manages symlinks into a shared DRBD partition
root@node1:~# aptitude install drbd8-utils drbdlinks
</code></pre>
<h3>关闭开机自起</h3>
<pre><code>root@node1:~# /etc/init.d/drbd status
● drbd.service - Distributed Replicated Block Device
   Loaded: loaded (/lib/systemd/system/drbd.service; enabled)
   Active: inactive (dead)
root@node1:~# update-rc.d drbd disable
insserv: warning: current start runlevel(s) (empty) of script `drbd' overrides LSB defaults (2 3 4 5).
insserv: warning: current stop runlevel(s) (0 1 2 3 4 5 6) of script `drbd' overrides LSB defaults (0 1 6).
root@node1:~# /etc/init.d/drbd status
● drbd.service - Distributed Replicated Block Device
   Loaded: loaded (/lib/systemd/system/drbd.service; disabled)
   Active: inactive (dead)
</code></pre>
<h3>drbd 配置：</h3>
<ul>
<li>
<p>主要参考：</p>
<pre><code>http://dev.mysql.com/doc/mysql-fabric/1.6/en/fabric-pacemaker-config-drbd.html
</code></pre>
</li>
<li>
<p>详细配置如下： /etc/drbd.d/global_common.conf</p>
<pre><code>global {
        usage-count yes;
        # minor-count dialog-refresh disable-ip-verification
}

common {
        #使用DRBD的同步协议 C
        protocol C;
        handlers {
                # These are EXAMPLE handlers only.
                # They may have severe implications,
                # like hard resetting the node under certain circumstances.
                # Be careful when chosing your poison.

            # pri-on-incon-degr "/usr/lib/drbd/notify-pri-on-incon-degr.sh; /usr/lib/drbd/notify-emergency-reboot.sh; echo b &gt; /proc/sysrq-trigger ; reboot -f";
            # pri-lost-after-sb "/usr/lib/drbd/notify-pri-lost-after-sb.sh; /usr/lib/drbd/notify-emergency-reboot.sh; echo b &gt; /proc/sysrq-trigger ; reboot -f";
            # local-io-error "/usr/lib/drbd/notify-io-error.sh; /usr/lib/drbd/notify-emergency-shutdown.sh; echo o &gt; /proc/sysrq-trigger ; halt -f";
             fence-peer "/usr/lib/drbd/crm-fence-peer.sh";
            # split-brain "/usr/lib/drbd/notify-split-brain.sh root";
            # out-of-sync "/usr/lib/drbd/notify-out-of-sync.sh root";
            # before-resync-target "/usr/lib/drbd/snapshot-resync-target-lvm.sh -p 15 -- -c 16k";
             after-resync-target /usr/lib/drbd/unsnapshot-resync-target-lvm.sh;
    }

    startup {
            # wfc-timeout degr-wfc-timeout outdated-wfc-timeout wait-after-sb
            # degraded cluster 在重启之后等待连接的时间
            degr-wfc-timeout 120;
            # outdated cluter 等待连接的超时时间
            outdated-wfc-timeout 2;
    }

    options {
            # cpu-mask on-no-data-accessible
    }

    disk {
            # size on-io-error fencing disk-barrier disk-flushes
            # disk-drain md-flushes resync-rate resync-after al-extents
            # c-plan-ahead c-delay-target c-fill-target c-max-rate
            # c-min-rate disk-timeout
            # 如果出现 IO 错误，则 detach 掉这个磁盘（放弃这个磁盘， drbd 工作为无磁盘模式）
            on-io-error detach;
    }
net {
            # protocol timeout max-epoch-size max-buffers unplug-watermark
            # connect-int ping-int sndbuf-size rcvbuf-size ko-count
            # allow-two-primaries cram-hmac-alg shared-secret after-sb-0pri
            # after-sb-1pri after-sb-2pri always-asbp rr-conflict
            # ping-timeout data-integrity-alg tcp-cork on-congestion
            # congestion-fill congestion-extents csums-alg verify-alg
            # use-rle
            # Set the encryption algorithm
            cram-hmac-alg "sha1";
            # Set an encryption key
            shared-secret "p4ssdr8d";
            after-sb-0pri discard-zero-changes;
            after-sb-1pri discard-secondary;
            after-sb-2pri disconnect;
            rr-conflict disconnect;
    }

    syncer {
            # rate after al-extents use-rle cpu-mask verify-alg csums-alg
            rate 1024M;
            # hot area detection 的大小
            al-extents 257;
            # 何时进入 disk less mode
            on-no-data-accessible io-error;
    }
</code></pre>
<p>}</p>
<ul>
<li>
<p>创建资源必须以 .res 结尾 /etc/drbd.d/drbd.res</p>
<pre><code># add the drbd resource

resource drbd {
        on node1 {
                # DRBD设备名称
                device  /dev/drbd0;
                # drbd0使用的磁盘分区为"sda9"
                disk    /dev/sda9;
                # 设置DRBD监听地址与端口
                address 10.120.164.105:7788;
                # 使用上面配置的 disk 来存储 drbd meta data
                meta-disk internal;
        }

        on node2 {
                # DRBD设备名称
                device  /dev/drbd0;
                # drbd0使用的磁盘分区为"sda9"
                disk    /dev/sda9;
                # 设置DRBD监听地址与端口
                address 10.120.164.106:7788;
                # 使用上面配置的 disk 来存储 drbd meta data
                meta-disk internal;
        }
}
</code></pre>
</li>
</ul>
</li>
<li>
<p>node2 上也同样配置，我是把这份配置直接 copy 到 node2 上的</p>
</li>
</ul>
<h3>两台机上为资源创建 drbd 设备:</h3>
<pre><code>    root@node2:/etc/drbd.d# drbdadm create-md drbd

      --==  Thank you for participating in the global usage survey  ==--
    The server's response is:

    you are the 339th user to install this version
    initializing activity log
    NOT initializing bitmap
    Writing meta data...
    New drbd meta data block successfully created.
    success

    root@node1:~# /etc/init.d/drbd start
    [ ok ] Starting drbd (via systemctl): drbd.service.
</code></pre>
<ul>
<li>
<p>查看状态:</p>
<pre><code>root@node1:~# /etc/init.d/drbd status
● drbd.service - Distributed Replicated Block Device
   Loaded: loaded (/lib/systemd/system/drbd.service; disabled)
   Active: active (exited) since Mon 2015-11-16 12:01:18 CST; 42s ago
  Process: 7135 ExecStart=/sbin/drbdadm sh-b-pri all (code=exited, status=0/SUCCESS)
  Process: 7131 ExecStart=/sbin/drbdadm wait-connect all (code=exited, status=0/SUCCESS)
  Process: 7105 ExecStart=/sbin/drbdadm adjust-with-progress all (code=exited, status=0/SUCCESS)
  Process: 7102 ExecStartPre=/sbin/drbdadm sh-nop (code=exited, status=0/SUCCESS)
 Main PID: 7135 (code=exited, status=0/SUCCESS)

Nov 16 12:01:01 node1 drbdadm[7105]: [
Nov 16 12:01:01 node1 drbdadm[7105]: create res: drbd
Nov 16 12:01:01 node1 drbdadm[7105]: prepare disk: drbd
Nov 16 12:01:01 node1 drbdadm[7105]: adjust disk: drbd
Nov 16 12:01:01 node1 drbdadm[7105]: adjust net: drbd
Nov 16 12:01:01 node1 drbdadm[7105]: ]
</code></pre>
</li>
</ul>
<h3>初始化设备同步</h3>
<pre><code>    root@node1:~# drbdadm -- --overwrite-data-of-peer primary drbd
</code></pre>
<ul>
<li>
<p>查看同步:</p>
<pre><code>root@node1:~# cat /proc/drbd
version: 8.4.3 (api:1/proto:86-101)
srcversion: 1A9F77B1CA5FF92235C2213
 0: cs:SyncSource ro:Primary/Secondary ds:UpToDate/Inconsistent C r-----
    ns:1986560 nr:0 dw:0 dr:1987472 al:0 bm:121 lo:0 pe:0 ua:0 ap:0 ep:1 wo:f oos:30897992
    [&gt;...................] sync'ed:  6.1% (30172/32112)Mfinish: 0:13:45 speed: 37,400 (38,200) K/sec
root@node1:~#
看到有同步进度
也可以使用以下命令查看
root@node1:~# drbd-overview
 0:drbd/0  SyncSource Primary/Secondary UpToDate/Inconsistent
    [==&gt;.................] sync'ed: 19.6% (25840/32112)Mfinish: 0:12:16 speed: 35,896 (36,080) K/sec
root@node1:~#

node2 查看：

root@node2:~# cat /proc/drbd
version: 8.4.3 (api:1/proto:86-101)
srcversion: 1A9F77B1CA5FF92235C2213
 0: cs:SyncTarget ro:Secondary/Primary ds:Inconsistent/UpToDate C r-----
    ns:0 nr:4812800 dw:4811776 dr:0 al:0 bm:293 lo:1 pe:0 ua:1 ap:0 ep:1 wo:f oos:28072776
    [=&gt;..................] sync'ed: 14.7% (27412/32112)Mfinish: 0:13:14 speed: 35,328 (36,728) want: 102,400 K/sec
root@node2:~#
</code></pre>
</li>
</ul>
<h3>在 primary 上，格式化 drbd 设备</h3>
<pre><code>    root@node1:~# mkfs.ext4 /dev/drbd0
    mke2fs 1.42.12 (29-Aug-2014)
    Creating filesystem with 8221138 4k blocks and 2056192 inodes
    Filesystem UUID: fdf6b05c-65e4-487e-9015-0679eaf08f95
    Superblock backups stored on blocks:
        32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632, 2654208,
        4096000, 7962624

    Allocating group tables: done
    Writing inode tables: done
    Creating journal (32768 blocks): done
    Writing superblocks and filesystem accounting information: done
</code></pre>
<ul>
<li>注意：node2上不需要格式化，他会自动同步过去</li>
</ul>
<h2>安装mysql</h2>
<h3>node1 和 node2 上分别进行安装，并关闭开机自起</h3>
<pre><code>    root@node1:~# aptitude install mysql-server mysql-client
    root@node1:~# systemctl stop mysql
    root@node1:~# update-rc.d mysql disable
</code></pre>
<h3>primary 上临时性挂载 drbd 分区到 /data</h3>
<pre><code>    root@node1:~# mount /dev/drbd0 /data
</code></pre>
<h3>primary 上迁移 MySQL 文件</h3>
<pre><code>        root@node1:~# mkdir -p /data/mysql/etc
        root@node1:~# mkdir -p /data/mysql/data
        root@node1:~# mkdir -p /data/mysql/log
        root@node1:~# mkdir -p /data/mysql/tmp
        root@node1:~# rsync -av /etc/mysql/ /data/mysql/etc/
        root@node1:~# rsync -av /var/lib/mysql/ /data/mysql/data/

        root@node1:~# chown -R mysql.mysql /data/mysql/
</code></pre>
<h3>primary 上修改 /data/mysql/etc/my.cnf 配置，让 MySQL 使用 /data 目录</h3>
<pre><code>        root@node1:/data/mysql# vim my.cnf
        #主要修改如下两行
        datadir         = /data/mysql/data
        tmpdir          = /data/mysql/tmp
</code></pre>
<h3>检查mysql能否正常启动</h3>
<pre><code>    root@node1:/data/mysql/etc# systemctl status mysql
    ● mysql.service - LSB: Start and stop the mysql database server daemon
       Loaded: loaded (/etc/init.d/mysql)
       Active: active (running) since Mon 2015-11-16 14:57:15 CST; 2s ago
      Process: 10260 ExecStop=/etc/init.d/mysql stop (code=exited, status=0/SUCCESS)
      Process: 10305 ExecStart=/etc/init.d/mysql start (code=exited, status=0/SUCCESS)
       CGroup: /system.slice/mysql.service
               ├─10332 /bin/sh /usr/bin/mysqld_safe
               └─10679 /usr/sbin/mysqld --basedir=/usr --datadir=/data/mysql/data --plugin-dir=/usr/lib/mysql/plugin --user=mysql --log-...

    Nov 16 14:57:15 node1 mysql[10305]: Starting MySQL database server: mysqld ..
    Nov 16 14:57:15 node1 mysql[10305]: Checking for tables which need an upgrade, are corrupt or were
    Nov 16 14:57:15 node1 mysql[10305]: not closed cleanly..
    root@node1:/data/mysql/etc#
    看到已正常使用 /data/mysql/data 下文件启动了
</code></pre>
<h3>测试 MySQL 可以正常运行之后，停止 MySQL，卸载掉 /data 分区并且停止 drbd</h3>
<pre><code>    root@node1:/data/mysql/etc# systemctl stop mysql

    root@node1:/data/mysql/etc# systemctl status drbd
    root@node1:/data/mysql/etc# umount /data/
    umount: /data/: target is busy
            (In some cases useful info about processes that
             use the device is found by lsof(8) or fuser(1).)
    root@node1:/data/mysql/etc# cd
    root@node1:~#
    root@node1:~# umount /data
</code></pre>
<ul>
<li>
<p>下面是将 node1 降为secondary node1 升为 primary 测试，可以不用看</p>
<pre><code>#####将node1改为secodary
root@node1:~# umount /data/
root@node1:~# drbd-overview
 0:drbd/0  Connected Primary/Secondary UpToDate/UpToDate
root@node1:~# drbdadm secondary drbd
root@node1:~# drbd-overview
 0:drbd/0  Connected Secondary/Secondary UpToDate/UpToDate
root@node1:~#

######将node2改为primary
root@node2:/data# drbd-overview
 0:drbd/0  Connected Secondary/Primary UpToDate/UpToDate
root@node2:/data# drbdadm primary drbd
root@node2:/data# drbd-overview
 0:drbd/0  Connected Primary/Secondary UpToDate/UpToDate
</code></pre>
</li>
</ul>
<h2>安装pacemaker and corosync</h2>
<h3>debian 8 下安装 pacemaker and</h3>
<ul>
<li>debian 8 的 jessie 源没有这连个软件，需要下载源码编译安装，<a href="http://clusterlabs.org/wiki/Compiling_on_Debian">详情参考</a></li>
</ul>
<h3>相关软件如下：</h3>
<pre><code>    libqb 0.17.0
    corosync 2.3.3
    cluster-glue 1.0.12
    resource-agents 3.9.5
    pacemaker 1.1.12
    crmsh 2.1.0
</code></pre>
<ul>
<li>
<p>编译环境</p>
<pre><code>    root@node1:~# apt-get install build-essential

    apt-get install automake autoconf
    apt-get install libtool
    apt-get install pkg-config

    git clone https://github.com/ClusterLabs/libqb.git

    apt-get install libnss3-dev groff
    apt-get install libaio-dev libtool-bin
    root@node1:~# aptitude install cluster-glue

    root@node1:~# apt-get install uuid-dev
</code></pre>
</li>
<li>
<p>报错：</p>
<pre><code>Job for openhpid.service failed. See 'systemctl status openhpid.service' and 'journalctl -xn' for details.
invoke-rc.d: initscript openhpid, action "start" failed.
dpkg: error processing package openhpid (--configure):
 subprocess installed post-installation script returned error exit status 1
Setting up libxml2-dev:amd64 (2.9.1+dfsg1-5) ...
Errors were encountered while processing:
 openhpid
E: Sub-process /usr/bin/dpkg returned an error code (1)
</code></pre>
</li>
<li>
<p>找了好几种解决办法，都不行，在查了下这个软件跟我们测试不相干，就把他卸载了，就可以了</p>
<pre><code>root@node1:~# apt-get remove openhpid
</code></pre>
</li>
</ul>
<h3>具体编译安装步骤参考：</h3>
<pre><code>    http://clusterlabs.org/wiki/Compiling_on_Debian
</code></pre>
<h3>corosync 具体配置参考：</h3>
<pre><code>    http://dev.mysql.com/doc/mysql-utilities/1.5/en/fabric-pacemaker-config-pacemaker.html

    root@node1:~# view /etc/corosync/corosync.conf
    # Please read the corosync.conf.5 manual page
    totem {
            version: 2

            # crypto_cipher and crypto_hash: Used for mutual node authentication.
            # If you choose to enable this, then do remember to create a shared
            # secret with "corosync-keygen".
            # enabling crypto_cipher, requires also enabling of crypto_hash.
            crypto_cipher: none
            crypto_hash: none

            # interface: define at least one interface to communicate
            # over. If you define more than one interface stanza, you must
            # also set rrp_mode.
            interface {
                    # Rings must be consecutively numbered, starting at 0.
                    ringnumber: 0
                    # This is normally the *network* address of the
                    # interface to bind to. This ensures that you can use
                    # identical instances of this configuration file
                    # across all your cluster nodes, without having to
                    # modify this option.
                    bindnetaddr: 10.120.164.0
                    # However, if you have multiple physical network
                    # interfaces configured for the same subnet, then the
                    # network address alone is not sufficient to identify
                    # the interface Corosync should bind to. In that case,
                    # configure the *host* address of the interface
                    # instead:
                    # bindnetaddr: 192.168.1.1
                    # When selecting a multicast address, consider RFC
                    # 2365 (which, among other things, specifies that
                    # 239.255.x.x addresses are left to the discretion of
                    # the network administrator). Do not reuse multicast
                    # addresses across multiple Corosync clusters sharing
                    # the same network.
                    mcastaddr: 239.255.1.1
                    # Corosync uses the port you specify here for UDP
                    # messaging, and also the immediately preceding
                    # port. Thus if you set this to 5405, Corosync sends
                    # messages over UDP ports 5405 and 5404.
                    mcastport: 5405
                    # Time-to-live for cluster communication packets. The
                    # number of hops (routers) that this ring will allow
                    # itself to pass. Note that multicast routing must be
                    # specifically enabled on most network routers.
                    ttl: 1
            }
    }
    logging {
            # Log the source file and line where messages are being
            # generated. When in doubt, leave off. Potentially useful for
            # debugging.
            fileline: off
            # Log to standard error. When in doubt, set to no. Useful when
            # running in the foreground (when invoking "corosync -f")
            to_stderr: no
            # Log to a log file. When set to "no", the "logfile" option
            # must not be set.
            to_logfile: yes
            logfile: /var/log/cluster/corosync.log
            # Log to the system log daemon. When in doubt, set to yes.
            to_syslog: yes
            # Log debug messages (very verbose). When in doubt, leave off.
            debug: off
            # Log messages with time stamps. When in doubt, set to on
            # (unless you are only logging to syslog, where double
            # timestamps can be annoying).
            timestamp: on
            logger_subsys {
                    subsys: QUORUM
                    debug: off
            }
    }

    quorum {
            # Enable and configure quorum subsystem (default: off)
            # see also corosync.conf.5 and votequorum.5
            provider: corosync_votequorum
            two_node: 1
            wait_for_all: 1
    }
    nodelist {
            node {
            ring0_addr: 10.120.164.105
            nodeid: 1
            }
            node {
            ring0_addr: 10.120.164.106
            nodeid: 2
            }
}

vim /etc/corosync/service.d/pcmk

    service {
      # Load the Pacemaker Cluster Resource Manager
      name: pacemaker
      ver: 1
    }   
</code></pre>
<h3>启动 corosync</h3>
<pre><code>    root@node1:/etc/corosync# systemctl start corosync
    root@node1:/etc/corosync# systemctl status corosync
    ● corosync.service - LSB: Starts and stops Corosync Cluster Engine.
       Loaded: loaded (/etc/init.d/corosync)
       Active: active (exited) since Mon 2015-11-16 20:18:34 CST; 3s ago
      Process: 10394 ExecStart=/etc/init.d/corosync start (code=exited, status=0/SUCCESS)

    Nov 16 20:18:34 node1 corosync[10394]: Starting Corosync Cluster Engine (corosync): [  OK  ]
    root@node1:/etc/corosync#
</code></pre>
<h3>启动 pacemaker</h3>
<pre><code>    root@node1:/etc/corosync# /etc/init.d/pacemaker status
    pacemakerd is stopped
    root@node1:/etc/corosync# /etc/init.d/pacemaker start
    Starting Pacemaker Cluster Manager[  OK  ]
    root@node1:/etc/corosync# /etc/init.d/pacemaker status
    pacemakerd (pid 10452) is running...
</code></pre>
<h4>查看启动过程是否产生错误信息；如下信息可以忽略</h4>
<pre><code>root@node1:~/crmsh# grep ERROR: /var/log/cluster/corosync.log
root@node1:~/crmsh# grep  TOTEM  /var/log/cluster/corosync.log
Nov 16 20:17:05 [10381] node1 corosync notice  [TOTEM ] Initializing transport (UDP/IP Multicast).
Nov 16 20:17:05 [10381] node1 corosync notice  [TOTEM ] Initializing transmit/receive security (NSS) crypto: none hash: none
Nov 16 20:17:05 [10381] node1 corosync notice  [TOTEM ] The network interface [10.120.164.105] is now up.
Nov 16 20:17:05 [10381] node1 corosync notice  [TOTEM ] A new membership (10.120.164.105:4) was formed. Members joined: 175678569
Nov 16 20:48:15 [10381] node1 corosync notice  [TOTEM ] A new membership (10.120.164.105:8) was formed. Members joined: 175678570
</code></pre>
<h4>查看初始化成员节点通知是否正常发出</h4>
<pre><code>root@node1:~/crmsh# grep  TOTEM  /var/log/cluster/corosync.log
Nov 16 20:17:05 [10381] node1 corosync notice  [TOTEM ] Initializing transport (UDP/IP Multicast).
Nov 16 20:17:05 [10381] node1 corosync notice  [TOTEM ] Initializing transmit/receive security (NSS) crypto: none hash: none
Nov 16 20:17:05 [10381] node1 corosync notice  [TOTEM ] The network interface [10.120.164.105] is now up.
Nov 16 20:17:05 [10381] node1 corosync notice  [TOTEM ] A new membership (10.120.164.105:4) was formed. Members joined: 175678569
Nov 16 20:48:15 [10381] node1 corosync notice  [TOTEM ] A new membership (10.120.164.105:8) was formed. Members joined: 175678570
root@node1:~/crmsh#
</code></pre>
<h4>查看pacemaker是否正常启动</h4>
<pre><code>Nov 16 20:46:03 [10452] node1 pacemakerd:     info: pcmk_cpg_membership:    Node 175678569 joined group pacemakerd (counter=0.0)
Nov 16 20:46:03 [10452] node1 pacemakerd:     info: pcmk_cpg_membership:    Node 175678569 still member of group pacemakerd (peer=node1, counter=0.0)
Nov 16 20:46:03 [10454] node1        cib:     info: pcmk_cpg_membership:    Node 175678569 joined group cib (counter=0.0)
Nov 16 20:46:03 [10454] node1        cib:     info: pcmk_cpg_membership:    Node 175678569 still member of group cib (peer=node1, counter=0.0)


root@node1:~# crm configure property no-quorum-policy=ignore
root@node1:~# crm configure rsc_defaults resource-stickiness=100
root@node1:~# crm configure property stonith-enabled=false
</code></pre>
<h2>node1上配置crm</h2>
<h3>设置 DRBD</h3>
<pre><code>root@node1:~# crm
crm(live)# configure
crm(live)configure# primitive p_drbd_mysql ocf:linbit:drbd params drbd_resource="drbd" op monitor interval='15s'
crm(live)configure# m
master    modgroup  monitor   ms
crm(live)configure# ms ms_drbd_mysql p_drbd_mysql meta master-max="1" master-node-max="1" clone-max="2" clone-node-max="1" notify="true"
crm(live)configure# primitive p_fs_mysql ocf:heartbeat:Filesystem params device="/dev/drbd0" directory="/data" fstype="ext4"

# 设置一个浮动 IP 10.120.164.107 并且绑定在 eth1 网卡上
crm(live)configure# primitive p_ip_mysql ocf:heartbeat:IPaddr2 params ip="10.120.164.107" cidr_netmask="32" nic="eth1"
</code></pre>
<h3>设置如何启动 MySQL</h3>
<pre><code>crm(live)configure# primitive p_mysql ocf:heartbeat:mysql params binary="/usr/sbin/mysqld" config="/data/mysql/etc/my.cnf" datadir="/data/mysql/data" pid="/var/run/mysqld/mysqld.pid" socket="/var/run/mysqld/mysqld.sock" user="mysql" group="mysql" additional_parameters="--user=mysql" op start timeout=120s op stop timeout=120s op monitor interval=20s timeout=30s
</code></pre>
<h3>将上面定义的所有的资源加到分组</h3>
<pre><code>crm(live)configure# group g_mysql p_fs_mysql p_ip_mysql p_mysql
</code></pre>
<h3>设置资源之间的依赖关系</h3>
<pre><code>crm(live)configure# colocation c_mysql_on_drbd inf: g_mysql ms_drbd_mysql:Master
crm(live)configure# order o_drbd_before_mysql inf: ms_drbd_mysql:promote g_mysql:start
</code></pre>
<h6>为了防止当网络分隔时产生脑裂情况，pacemaker可以设置ping一个独立的网络资源节点,并且在节点发生网络隔离时，阻止其成为drbd master</h6>
<pre><code>crm(live)configure# primitive p_ping ocf:pacemaker:ping params name="ping" multiplier="1000" host_list="10.120.164.1" \
   &gt; op monitor interval="15s" timeout="60s" start timeout="60s"
crm(live)configure#
crm(live)configure# location l_drbd_master_on_ping ms_drbd_mysql \
   &gt; rule $role="Master" -inf: not_defined ping or ping number:lte 0
crm(live)configure# commit
</code></pre>
<h3>查看集群状态：</h3>
<pre><code>crm(live)configure# show
primitive p_drbd_mysql ocf:linbit:drbd \
    params drbd_resource=drbd \
    op monitor interval=15s
primitive p_fs_mysql Filesystem \
    params device="/dev/drbd0" directory="/data" fstype=ext4
primitive p_ip_mysql IPaddr2 \
    params ip=10.120.164.107 cidr_netmask=32 nic=eth1
primitive p_mysql mysql \
    params binary="/usr/sbin/mysqld" config="/data/mysql/etc/my.cnf" datadir="/data/mysql/data" pid="/var/run/mysqld/mysqld.pid" socket="/var/run/mysqld/mysqld.sock" user=mysql group=mysql additional_parameters="--user=mysql" \
    op start timeout=120s interval=0 \
    op stop timeout=120s interval=0 \
    op monitor interval=20s timeout=30s
primitive p_ping ocf:pacemaker:ping \
    params name=ping multiplier=1000 host_list=10.120.164.1 \
    op monitor interval=15s timeout=60s start
group g_mysql p_fs_mysql p_ip_mysql p_mysql
ms ms_drbd_mysql p_drbd_mysql \
    meta master-max=1 master-node-max=1 clone-max=2 clone-node-max=1 notify=true
colocation c_mysql_on_drbd inf: g_mysql ms_drbd_mysql:Master
location l_drbd_master_on_ping ms_drbd_mysql \
    rule $role=Master -inf: not_defined ping or ping number:lte 0
order o_drbd_before_mysql inf: ms_drbd_mysql:promote g_mysql:start
property cib-bootstrap-options: \
    no-quorum-policy=ignore \
    stonith-enabled=false
rsc_defaults rsc-options: \
    resource-stickiness=100
crm(live)configure#


root@node1:~# crm status
Last updated: Tue Nov 17 15:22:32 2015      Last change: Tue Nov 17 15:11:07 2015 by hacluster via crmd on node1
Stack: corosync
Current DC: node1 (version 1.1.13-e54e3c1) - partition with quorum
2 nodes and 6 resources configured

Online: [ node1 node2 ]

Full list of resources:

 Master/Slave Set: ms_drbd_mysql [p_drbd_mysql]
     Masters: [ node1 ]
     Slaves: [ node2 ]
 Resource Group: g_mysql
     p_fs_mysql (ocf::heartbeat:Filesystem):    Started node1
     p_ip_mysql (ocf::heartbeat:IPaddr2):   Started node1
     p_mysql    (ocf::heartbeat:mysql): Started node1
 p_ping (ocf::pacemaker:ping):  Started node1
</code></pre>
<h2>测试服务是否切换</h2>
<p>node1 上创建数据库 lege</p>
<pre><code> mysql&gt; create database lege;
Query OK, 1 row affected (0.00 sec)

mysql&gt; show databases;
+--------------------+
| Database           |
+--------------------+
| information_schema |
| lege               |
| mysql              |
| performance_schema |
+--------------------+
4 rows in set (0.00 sec)
</code></pre>
<h3>模拟主节点出现故障,将主节点设置为&#8221;Standby&#8221;状态，查看服务是否转移到备用节点上</h3>
<pre><code>root@node1:~# crm node standby node1
root@node1:~# mysql
ERROR 2002 (HY000): Can't connect to local MySQL server through socket '/var/run/mysqld/mysqld.sock' (2)
</code></pre>
<h3>node1 已变为 secondary</h3>
<pre><code>     root@node1:~# drbd-overview
     0:drbd/0  Connected Secondary/Primary UpToDate/UpToDate
</code></pre>
<h3>到node2上登录mysql</h3>
<pre><code> mysql&gt; show databases;
+--------------------+
| Database           |
+--------------------+
| information_schema |
| lege               |
| mysql              |
| performance_schema |
+--------------------+
4 rows in set (0.01 sec)

mysql&gt;
</code></pre>
<h3>看到已经有 lege 这个数据库，并且node2 自动切换为 primary</h3>
<pre><code>    root@node2:~# drbd-overview
     0:drbd/0  Connected Primary/Secondary UpToDate/UpToDate /data ext4 31G 78M 30G 1%
</code></pre>
<h2>小结：</h2>
<pre><code>假如node1已修复好重新上线；这时node2节点上的服务是不会重新切换回node1节点上面的；如果想让切换也不是不可以，这需要设置资源粘性；但建议不要切换，避免服务切换时浪费不必要的资源。
所有服务都可以正常工作；到这里Mysql高可用已全部完成，而且还验证了Mysql服务的正常运行与数据的完整性；
</code></pre>

<div style='clear:both;'></div>

 
		<script type="text/javascript">
		var ujian_config = {
			'num':5,
			'showType':2,
			'bgColor':"",
			'mouseoverColor':"#E6F3DE",
			'textColor':"#333333",
			'hoverTextColor':"#333333",
			'borderColor':"#dddddd",
			'picSize':96,
			'target':0,
			'textHeight':60,
			'defaultPic':"",
			'itemTitle':"您可能喜欢："
		}</script>
	<script type="text/javascript" src="http://v1.ujian.cc/code/ujian.js"></script><p>转载请注明：<a href="http://112.74.18.181">失眠猪的博客</a> &raquo; <a href="http://112.74.18.181/?p=120">MySQL HA on debian8</a></p>

      
<div class="article-social">
			<a href="javascript:;" data-action="ding" data-id="120" id="Addlike" class="action"><i class="fa fa-heart-o"></i>喜欢 (<span class="count">0</span>)</a><span class="or">or</span><span class="action action-share bdsharebuttonbox"><i class="fa fa-share-alt"></i>分享 (<span class="bds_count" data-cmd="count" title="累计分享0次">0</span>)<div class="action-popover"><div class="popover top in"><div class="arrow"></div><div class="popover-content"><a href="#" class="sinaweibo fa fa-weibo" data-cmd="tsina" title="分享到新浪微博"></a><a href="#" class="bds_qzone fa fa-star" data-cmd="qzone" title="分享到QQ空间"></a><a href="#" class="tencentweibo fa fa-tencent-weibo" data-cmd="tqq" title="分享到腾讯微博"></a><a href="#" class="qq fa fa-qq" data-cmd="sqq" title="分享到QQ好友"></a><a href="#" class="bds_renren fa fa-renren" data-cmd="renren" title="分享到人人网"></a><a href="#" class="bds_weixin fa fa-weixin" data-cmd="weixin" title="分享到微信"></a><a href="#" class="bds_more fa fa-ellipsis-h" data-cmd="more"></a></div></div></div></span>	
</div>
	</article>	
				<footer class="article-footer">
			</footer>
	<nav class="article-nav">
			<span class="article-nav-prev"><i class="fa fa-angle-double-left"></i> <a href="http://112.74.18.181/?p=90" rel="prev">apt出现no public key available for the following key IDs</a></span>
			<span class="article-nav-next"></span>
		</nav>

		<div class="related_top">
			<div class="related_posts"><ul class="related_img">
<div class=\"r_title\">没有相关文章!</div></ul>

<div class="relates">
<ul>
<li>暂无相关文章！</li>
</ul></div></div>		</div>
						<div id="respond" class="no_webshot">
		<form action="http://112.74.18.181/wp-comments-post.php" method="post" id="commentform">
		
		<div class="comt-title">
			<div class="comt-avatar pull-left">
				<img alt='' src='http://www.gravatar.com/avatar/96af1a5cb4b8bf513860628c94b10e67?s=54&amp;d=http%3A%2F%2F112.74.18.181%2Fwp-content%2Fthemes%2Fyusi1.0%2Fimg%2Fdefault.png%3Fs%3D54&amp;r=G' class='avatar avatar-54 photo' height='54' width='54' />			</div>
			<div class="comt-author pull-left">
			发表我的评论			</div>
			<a id="cancel-comment-reply-link" class="pull-right" href="javascript:;">取消评论</a>
		</div>
		
		<div class="comt">
			<div class="comt-box">
				<textarea placeholder="写点什么..." class="input-block-level comt-area" name="comment" id="comment" cols="100%" rows="3" tabindex="1" onkeydown="if(event.ctrlKey&amp;&amp;event.keyCode==13){document.getElementById('submit').click();return false};"></textarea>
				<div class="comt-ctrl">
					<button class="btn btn-primary pull-right" type="submit" name="submit" id="submit" tabindex="5"><i class="fa fa-check-square-o"></i> 提交评论</button>
					<div class="comt-tips pull-right"><input type='hidden' name='comment_post_ID' value='120' id='comment_post_ID' />
<input type='hidden' name='comment_parent' id='comment_parent' value='0' />
<p style="display: none;"><input type="hidden" id="akismet_comment_nonce" name="akismet_comment_nonce" value="41cd1433b5" /></p><p style="display: none;"><input type="hidden" id="ak_js" name="ak_js" value="23"/></p></div>
					<span data-type="comment-insert-smilie" class="muted comt-smilie"><i class="fa fa-smile-o"></i> 表情</span>
					<span class="muted comt-mailme"><label for="comment_mail_notify" class="checkbox inline" style="padding-top:0"><input type="checkbox" name="comment_mail_notify" id="comment_mail_notify" value="comment_mail_notify" checked="checked"/>有人回复时邮件通知我</label></span>
				</div>
			</div>

												</div>

		
	</form>
	</div>
<div id="postcomments">
	<div id="comments">
		<i class="fa fa-comments-o"></i> <b> (1)</b>个小伙伴在吐槽
	</div>
	<ol class="commentlist">
		<li class="comment byuser comment-author-lege bypostauthor even thread-even depth-1" id="comment-13"><div class="c-avatar"><img alt='' data-original='http://www.gravatar.com/avatar/96af1a5cb4b8bf513860628c94b10e67?s=54&amp;d=http%3A%2F%2F112.74.18.181%2Fwp-content%2Fthemes%2Fyusi1.0%2Fimg%2Fdefault.png%3Fs%3D54&amp;r=G' class='avatar avatar-54 photo' height='54' width='54' /><div class="c-main" id="div-comment-13"><p>test</p>
<div class="c-meta"><span class="c-author">lege</span>2015-11-24 09:12  (8小时前)<a class='comment-reply-link' href='/?p=120&#038;replytocom=13#respond' onclick='return addComment.moveForm( "div-comment-13", "13", "respond", "120" )' aria-label='回复给lege'>回复</a></div></div></div></li><!-- #comment-## -->
	</ol>
	<div class="commentnav"	>
			</div>
</div>
			</div>
</div>
<aside class="sidebar">	
<div class="widget widget_text"><div class="textwidget"><div class="social">

<a href="http://weibo.com/legeishere/profile?rightmod=1&wvr=6&mod=personinfo" rel="external nofollow" title="新浪微博" target="_blank"><i class="sinaweibo fa fa-weibo"></i></a><a class="weixin"><i class="weixins fa fa-weixin"></i><div class="weixin-popover"><div class="popover bottom in"><div class="arrow"></div><div class="popover-title">lege微信“legeishere”</div><div class="popover-content"><img src="http://112.74.18.181/wp-content/themes/yusi1.0/img/weixin.gif" ></div></div></div></a><a href="" rel="external nofollow" target="_blank"  title="订阅本站"><i class="rss fa fa-rss"></i></a>
</div></div></div>

<div class="widget widget_archive"><div class="title"><h2>文章归档</h2></div>		<ul>
	<li><a href='http://112.74.18.181/?m=201511'>2015年十一月</a>&nbsp;(6)</li>
		</ul>
</div><div class="widget widget_categories"><div class="title"><h2>分类目录</h2></div>		<ul>
	<li class="cat-item cat-item-13"><a href="http://112.74.18.181/?cat=13" >other</a>
</li>
	<li class="cat-item cat-item-17"><a href="http://112.74.18.181/?cat=17" >SA</a>
</li>
	<li class="cat-item cat-item-12"><a href="http://112.74.18.181/?cat=12" >shell</a>
</li>
	<li class="cat-item cat-item-8"><a href="http://112.74.18.181/?cat=8" >system</a>
</li>
		</ul>
</div><div class="widget widget_calendar"><div id="calendar_wrap"><table id="wp-calendar">
	<caption>2015年十一月</caption>
	<thead>
	<tr>
		<th scope="col" title="星期一">一</th>
		<th scope="col" title="星期二">二</th>
		<th scope="col" title="星期三">三</th>
		<th scope="col" title="星期四">四</th>
		<th scope="col" title="星期五">五</th>
		<th scope="col" title="星期六">六</th>
		<th scope="col" title="星期日">日</th>
	</tr>
	</thead>

	<tfoot>
	<tr>
		<td colspan="3" id="prev" class="pad">&nbsp;</td>
		<td class="pad">&nbsp;</td>
		<td colspan="3" id="next" class="pad">&nbsp;</td>
	</tr>
	</tfoot>

	<tbody>
	<tr>
		<td colspan="6" class="pad">&nbsp;</td><td>1</td>
	</tr>
	<tr>
		<td>2</td><td>3</td><td>4</td><td>5</td><td>6</td><td>7</td><td>8</td>
	</tr>
	<tr>
		<td>9</td><td>10</td><td>11</td><td>12</td><td>13</td><td>14</td><td>15</td>
	</tr>
	<tr>
		<td>16</td><td>17</td><td>18</td><td>19</td><td>20</td><td><a href="http://112.74.18.181/?m=20151121" title="shell 连续执行命令, windows 下命令行查看CPU负载, LXC 配置网络, linux vim 设置, apt出现no public key available for the following key IDs">21</a></td><td>22</td>
	</tr>
	<tr>
		<td>23</td><td id="today"><a href="http://112.74.18.181/?m=20151124" title="MySQL HA on debian8">24</a></td><td>25</td><td>26</td><td>27</td><td>28</td><td>29</td>
	</tr>
	<tr>
		<td>30</td>
		<td class="pad" colspan="6">&nbsp;</td>
	</tr>
	</tbody>
	</table></div></div><div class="widget d_tag"><div class="title"><h2></h2></div><div class="d_tags">暂无标签！</div></div></aside>
</section>
<footer class="footer">
    <div class="footer-inner">
        <div class="copyright pull-left">
         <a href="http://www.legeishere.com/" title="失眠猪的博客">失眠猪的博客</a> 版权所有，保留一切权利 ·  ·   基于WordPress构建   © 2015 ·   托管于 <a rel="nofollow" target="_blank" href="http://yusi123.com/go/aliyun">阿里云主机</a> 
        </div>
        <div class="trackcode pull-right">
                    </div>
    </div>
</footer>

<!-- ngg_resource_manager_marker --><script type='text/javascript'>
/* <![CDATA[ */
var viewsCacheL10n = {"admin_ajax_url":"http:\/\/112.74.18.181\/wp-admin\/admin-ajax.php","post_id":"120"};
/* ]]> */
</script>
<script type='text/javascript' src='http://112.74.18.181/wp-content/plugins/wp-postviews/postviews-cache.js?ver=1.68'></script>
<script type='text/javascript' src='http://112.74.18.181/wp-content/plugins/markdown/js/markdown.min.js?ver=1.5.1'></script>
<script type='text/javascript' src='http://112.74.18.181/wp-content/plugins/akismet/_inc/form.js?ver=3.1.3'></script>
<script>with(document)0[(getElementsByTagName("head")[0]||body).appendChild(createElement("script")).src="http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion="+~(-new Date()/36e5)];</script></body>
</html>

<!-- Dynamic page generated in 0.457 seconds. -->
<!-- Cached page generated by WP-Super-Cache on 2015-11-24 17:23:42 -->
